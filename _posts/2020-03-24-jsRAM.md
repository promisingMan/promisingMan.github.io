---
layout:     post
title:      "js内存"
subtitle:   " \"js每天学之js内存\""
date:       2020-03-27 19:37:24
author:     "ZH"
header-img: "img/post-bg-alitrip.jpg"
catalog: true
tags:
    - JS
---

> "千里之行,始于足下"

# 简介
如果你学过或者了解过C语言，那么你一定听过malloc()和free()函数，这两个函数是来管理内存的接口。但是在js中，
js在创建变量的时候已经自动的分配了内存，并且在它不使用的时候自动销毁。销毁的过程叫做垃圾回收。但是这个自动化
过程和许多框架高度集成一样，让开发者以为我们并不需要关心内存管理

# 内存生命周期

不管什么语言，其实内存周期是一样的
- 分配你需要的内存
- 使用分配的内存进行读写操作
- 不需要时将其释放归还
所有语言第二部分是很明确的，第一和第三部分在底层语言也是明确的，但是在像js这种高级语言中，大部分都是很隐晦的

## JavaScript的内存分配

### 值的初始化

为了不让程序员去操心分配内存，JavaScript在定义变量时就已经完成了内存分配

```
var n = 123; // 给数值变量分配内存
var s = "azerty"; // 给字符串分配内存

var o = {
  a: 1,
  b: null
}; // 给对象及其包含的值分配内存

// 给数组及其包含的值分配内存（就像对象一样）
var a = [1, null, "abra"]; 

function f(a){
  return a + 2;
} // 给函数（可调用的对象）分配内存

// 函数表达式也能分配一个对象
someElement.addEventListener('click', function(){
  someElement.style.backgroundColor = 'blue';
}, false);
```
### 通过函数调用分配内存
有些函数调用结果是分配对象内存

```
var d = new Date() // 分配一个date对象
var e = document.creatElement('div') //分配一个dom元素

```

有些方法分配新变量或者新对象

```
var s = "azerty";
var s2 = s.substr(0, 3); // s2 是一个新的字符串
// 因为字符串是不变量，
// JavaScript 可能决定不分配内存，
// 只是存储了 [0-3] 的范围。

var a = ["ouais ouais", "nan nan"];
var a2 = ["generation", "nan nan"];
var a3 = a.concat(a2); 
// 新数组有四个元素，是 a 连接 a2 的结果
```
## 使用值
使用值的过程实际上是对分配内存进行读取与写入的操作。读取或写入可能是写入一个变量或者一个对象的属性值，
甚至函数的参数

## 当内存不再需要使用时释放
大多数内存管理问题都出现在这个阶段，在这里最艰难的问题出在如何找到哪些不需要的内存。在这往往要求开发人员来确定
在程序中哪块内存不需要并且释放她

高级语言嵌入了"垃圾回收去"，它的主要工作便是跟踪内存的分配与使用，以便当内存不再需要的时候进行释放。这只能是一个近似的过程
，要知道是否需要内存无法通过算法去解决

# 垃圾回收

从上文得知寻找内存是否是不再需要这问题是无法判断的，也就是说接下来的算法只能有限解决的问题，本节主要是了解主要的垃圾算法的局限问题

## 引用
垃圾回收算法主要依赖的是引用的概念，也就是说，一个对象如果有访问另一个对象的权限(隐式或者显式)，叫做一个对象引用另一个对象。例如一个js对象具有对它原型的引用(隐式引用)和对它属性的引用(显示引用)。

在这里，"对象"的概念不仅特指JavaScript对象，还包括函数作用域(或者全局语法作用域)